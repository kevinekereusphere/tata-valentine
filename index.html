<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Per Tata üíò</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- SCENA 1 -->
  <section id="scene1" class="scene active">
    <div class="scene-inner">
      <div class="hero">
        <div class="big-bg">Happy Valentine's Day</div>
        <div class="title">Ehi Tata üíò</div>
        <p class="subtitle">Ho una cosa per te. Tocca il cuore.</p>
      </div>

      <button id="bigHeart" class="big-heart" aria-label="Apri la sorpresa">‚ù§</button>

      <div id="particles" class="particles" aria-hidden="true"></div>
      <p class="hint">Funziona bene sia da telefono che da PC (tutto parte con un tap).</p>
    </div>
  </section>

  <!-- SCENA 2 -->
  <section id="scene2" class="scene">
    <div class="scene-inner">
      <div class="tree-wrap">
        <div class="tree">
          <div class="trunk"></div>
          <div class="crown" aria-hidden="true">
            <span class="leaf h1">‚ù§</span><span class="leaf h2">‚ù§</span><span class="leaf h3">‚ù§</span>
            <span class="leaf h4">‚ù§</span><span class="leaf h5">‚ù§</span><span class="leaf h6">‚ù§</span>
            <span class="leaf h7">‚ù§</span><span class="leaf h8">‚ù§</span><span class="leaf h9">‚ù§</span>
          </div>
        </div>

        <div class="story">
          <h2>Te amo mucho mi nena! üå≥</h2>
          <p>
            Vorrei vederti sempre sorridente, perche sei la mia stellina semplicemente fantastica!
            Sei la mia bimba ricordatelo, e goditi la giornata!‚ù§Ô∏è
            Un piccolo pensierino per la mia bimba..üò¢üòç‚ù§Ô∏è
          </p>
          <p class="story-big">Tata, ti amo troppo.</p>

          <button id="continueBtn" class="continue">Continua questa avventura ‚ú®</button>
        </div>
      </div>
    </div>
  </section>

  <!-- SCENA 3 (pagina finale) -->
  <section id="scene3" class="scene">
    <div class="scene-inner scene3">
      <div class="hero compact">
        <div class="big-bg">Happy Valentine's Day</div>
        <div class="title">Will you be my Valentine?</div>
        <p class="subtitle small">Tata, ti amo troppo.</p>
      </div>

      <div class="final-card">
        <!-- SLIDER -->
        <div class="slider" aria-label="Foto">
          <button class="nav prev" type="button" aria-label="Foto precedente">‚Äπ</button>

          <div class="viewport" id="viewport">
            <div class="track" id="track">
              <img src="img/photo1.jpg" alt="Foto 1" />
              <img src="img/photo2.jpg" alt="Foto 2" />
              <img src="img/photo3.jpg" alt="Foto 3" />
              <img src="img/photo4.jpg" alt="Foto 4" />
              <img src="img/photo5.jpg" alt="Foto 5" />
            </div>
          </div>

          <button class="nav next" type="button" aria-label="Foto successiva">‚Ä∫</button>

          <div class="dots" id="dots" aria-label="Indicatori foto"></div>
        </div>

        <!-- TESTO + BOTTONI -->
        <div class="msg">
          <h1>Tata üíò</h1>
          <p>Ho una domanda importantissima‚Ä¶</p>
          <p class="big">Vuoi essere la mia Valentine?</p>

          <div class="actions">
            <button id="yes" type="button">S√¨ ü•∞</button>
            <button id="no" type="button">No üôÉ</button>
          </div>

          <div id="result" class="result" aria-live="polite"></div>
        </div>
      </div>

      <!-- CUORE PIXEL -->
      <div class="heart-wrap">
        <div class="heart-container" aria-hidden="true">
          <!-- heart grid -->
          <div class="box transparent-bg"></div>
          <div class="box delay-10"></div>
          <div class="box delay-6"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box delay-1"></div>
          <div class="box delay-3"></div>
          <div class="box transparent-bg"></div>
          <div class="box clear delay-1"></div>
          <div class="box delay-2"></div>
          <div class="box delay-3"></div>
          <div class="box delay-4"></div>
          <div class="box transparent-bg"></div>
          <div class="box delay-5"></div>
          <div class="box delay-6"></div>
          <div class="box delay-7"></div>
          <div class="box delay-8"></div>
          <div class="box clear delay-10"></div>
          <div class="box delay-5"></div>
          <div class="box delay-3"></div>
          <div class="box delay-7"></div>
          <div class="box delay-1"></div>
          <div class="box delay-9"></div>
          <div class="box delay-2"></div>
          <div class="box delay-4"></div>
          <div class="box delay-8"></div>
          <div class="box clear delay-6"></div>
          <div class="box delay-4"></div>
          <div class="box delay-5"></div>
          <div class="box delay-6"></div>
          <div class="box delay-1"></div>
          <div class="box delay-9"></div>
          <div class="box delay-10"></div>
          <div class="box delay-3"></div>
          <div class="box delay-2"></div>
          <div class="box clear transparent-bg"></div>
          <div class="box delay-10"></div>
          <div class="box delay-9"></div>
          <div class="box delay-8"></div>
          <div class="box delay-2"></div>
          <div class="box delay-3"></div>
          <div class="box delay-5"></div>
          <div class="box delay-1"></div>
          <div class="box transparent-bg"></div>
          <div class="box clear transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box delay-4"></div>
          <div class="box delay-6"></div>
          <div class="box delay-1"></div>
          <div class="box delay-3"></div>
          <div class="box delay-2"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box clear transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box delay-7"></div>
          <div class="box delay-6"></div>
          <div class="box delay-3"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box clear transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box delay-5"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
          <div class="box transparent-bg"></div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // ===== scene controller =====
    const scene1 = document.getElementById("scene1");
    const scene2 = document.getElementById("scene2");
    const scene3 = document.getElementById("scene3");

    const bigHeart = document.getElementById("bigHeart");
    const particles = document.getElementById("particles");
    const continueBtn = document.getElementById("continueBtn");

    function showScene(sceneToShow) {
      [scene1, scene2, scene3].forEach(s => s.classList.remove("active"));
      sceneToShow.classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function spawnHeartParticles(count = 70) {
      particles.innerHTML = "";
      const rect = bigHeart.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      for (let i = 0; i < count; i++) {
        const p = document.createElement("span");
        p.className = "p";
        p.style.left = cx + "px";
        p.style.top = cy + "px";

        const angle = Math.random() * Math.PI * 2;
        const dist = 120 + Math.random() * 220;
        const dx = Math.cos(angle) * dist;
        const dy = Math.sin(angle) * dist;

        p.style.setProperty("--dx", dx.toFixed(0) + "px");
        p.style.setProperty("--dy", dy.toFixed(0) + "px");
        p.style.setProperty("--rot", (Math.random() * 720 - 360).toFixed(0) + "deg");
        p.style.setProperty("--dur", (700 + Math.random() * 700).toFixed(0) + "ms");
        p.textContent = "‚ù§";
        particles.appendChild(p);
      }
    }

    let exploded = false;
    bigHeart.addEventListener("click", () => {
      if (exploded) return;
      exploded = true;
      bigHeart.classList.add("pop");
      spawnHeartParticles(75);
      setTimeout(() => showScene(scene2), 1100);
    });

    continueBtn.addEventListener("click", () => showScene(scene3));

    // ===== final scene buttons =====
    const result = document.getElementById("result");
    document.getElementById("yes").addEventListener("click", () => {
      result.textContent = "YEAAAH! üíò Ti amo troppo, Tata. Buon San Valentino.";
      result.classList.add("show");
    });

    document.getElementById("no").addEventListener("click", () => {
      result.textContent = "Risposta sbagliata üò§ Riprovare finch√© esce 'S√¨'.";
      result.classList.add("show");
    });

    // ===== slider =====
    const track = document.getElementById("track");
    const viewport = document.getElementById("viewport");
    const dotsWrap = document.getElementById("dots");
    const prevBtn = document.querySelector(".nav.prev");
    const nextBtn = document.querySelector(".nav.next");
    const slides = Array.from(track.querySelectorAll("img"));
    let index = 0;
    let autoTimer = null;

    function buildDots() {
      dotsWrap.innerHTML = "";
      slides.forEach((_, i) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "dot" + (i === 0 ? " active" : "");
        b.ariaLabel = "Vai alla foto " + (i + 1);
        b.addEventListener("click", () => goTo(i, true));
        dotsWrap.appendChild(b);
      });
    }

    function updateDots() {
      const dots = dotsWrap.querySelectorAll(".dot");
      dots.forEach((d, i) => d.classList.toggle("active", i === index));
    }

    function goTo(i, user = false) {
      index = (i + slides.length) % slides.length;
      const w = viewport.clientWidth;
      track.style.transform = "translateX(" + (-index * w) + "px)";
      updateDots();
      if (user) restartAuto();
    }

    function next() { goTo(index + 1, true); }
    function prev() { goTo(index - 1, true); }

    prevBtn.addEventListener("click", prev);
    nextBtn.addEventListener("click", next);

    function restartAuto() {
      if (autoTimer) clearInterval(autoTimer);
      autoTimer = setInterval(() => goTo(index + 1, false), 4500);
    }

    // swipe
    let startX = null;
    viewport.addEventListener("pointerdown", (e) => {
      startX = e.clientX;
      viewport.setPointerCapture(e.pointerId);
    });

    viewport.addEventListener("pointerup", (e) => {
      if (startX === null) return;
      const dx = e.clientX - startX;
      startX = null;
      if (Math.abs(dx) < 35) return;
      if (dx < 0) next();
      else prev();
    });

    window.addEventListener("resize", () => goTo(index, false));

    buildDots();
    goTo(0, false);
    restartAuto();
  </script>
</body>
</html>
